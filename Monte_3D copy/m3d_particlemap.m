function [P_mat, R_vec] = m3d_particlemap(P_mat, R_vec, i, n_total, box_length)

  %% Map particles:
  P_mat((n_total+i),2:4) = P_mat(i,2:4)-box_length;
  R_vec((n_total+i),2) = R_vec(i,2);
  P_mat((2*n_total+i),2) = P_mat(i,2);
  P_mat((2*n_total+i),3:4) = P_mat(i,3:4)-box_length;
  R_vec((2*n_total+i),2) = R_vec(i,2);
  P_mat((3*n_total+i),2) = P_mat(i,2)+box_length;
  P_mat((3*n_total+i),3:4) = P_mat(i,3:4)-box_length;
  R_vec((3*n_total+i),2) = R_vec(i,2);
  P_mat((4*n_total+i),2) = P_mat(i,2)-box_length;
  P_mat((4*n_total+i),3) = P_mat(i,3);
  P_mat((4*n_total+i),4) = P_mat(i,4)-box_length;
  R_vec((4*n_total+i),2) = R_vec(i,2);
  P_mat((5*n_total+i),2:3) = P_mat(i,2:3);
  P_mat((5*n_total+i),4) = P_mat(i,4)-box_length;
  R_vec((5*n_total+i),2) = R_vec(i,2);
  P_mat((6*n_total+i),2) = P_mat(i,2)+box_length;
  P_mat((6*n_total+i),3) = P_mat(i,3);
  P_mat((6*n_total+i),4) = P_mat(i,4)-box_length;
  R_vec((6*n_total+i),2) = R_vec(i,2);
  P_mat((7*n_total+i),2) = P_mat(i,2)-box_length;
  P_mat((7*n_total+i),3) = P_mat(i,3)+box_length;
  P_mat((7*n_total+i),4) = P_mat(i,4)-box_length;
  R_vec((7*n_total+i),2) = R_vec(i,2);
  P_mat((8*n_total+i),2) = P_mat(i,2);
  P_mat((8*n_total+i),3) = P_mat(i,3)+box_length;
  P_mat((8*n_total+i),4) = P_mat(i,4)-box_length;
  R_vec((8*n_total+i),2) = R_vec(i,2);
  P_mat((9*n_total+i),2:3) = P_mat(i,2:3)+box_length;
  P_mat((9*n_total+i),4) = P_mat(i,4)-box_length;
  R_vec((9*n_total+i),2) = R_vec(i,2);
  P_mat((10*n_total+i),2:3) = P_mat(i,2:3)-box_length;
  P_mat((10*n_total+i),4) = P_mat(i,4);
  R_vec((10*n_total+i),2) = R_vec(i,2);
  P_mat((11*n_total+i),2) = P_mat(i,2);
  P_mat((11*n_total+i),3) = P_mat(i,3)-box_length;
  P_mat((11*n_total+i),4) = P_mat(i,4);
  R_vec((11*n_total+i),2) = R_vec(i,2);
  P_mat((12*n_total+i),2) = P_mat(i,2)+box_length;
  P_mat((12*n_total+i),3) = P_mat(i,3)-box_length;
  P_mat((12*n_total+i),4) = P_mat(i,4);
  R_vec((12*n_total+i),2) = R_vec(i,2);
  P_mat((13*n_total+i),2) = P_mat(i,2)-box_length;
  P_mat((13*n_total+i),3:4) = P_mat(i,3:4);
  R_vec((13*n_total+i),2) = R_vec(i,2);
  P_mat((14*n_total+i),2) = P_mat(i,2)+box_length;
  P_mat((14*n_total+i),3:4) = P_mat(i,3:4);
  R_vec((14*n_total+i),2) = R_vec(i,2);
  P_mat((15*n_total+i),2) = P_mat(i,2)-box_length;
  P_mat((15*n_total+i),3) = P_mat(i,3)+box_length;
  P_mat((15*n_total+i),4) = P_mat(i,4);
  R_vec((15*n_total+i),2) = R_vec(i,2);
  P_mat((16*n_total+i),2) = P_mat(i,2);
  P_mat((16*n_total+i),3) = P_mat(i,3)+box_length;
  P_mat((16*n_total+i),4) = P_mat(i,4);
  R_vec((16*n_total+i),2) = R_vec(i,2);
  P_mat((17*n_total+i),2:3) = P_mat(i,2:3)+box_length;
  P_mat((17*n_total+i),4) = P_mat(i,4);
  R_vec((17*n_total+i),2) = R_vec(i,2);
  P_mat((18*n_total+i),2:3) = P_mat(i,2:3)-box_length;
  P_mat((18*n_total+i),4) = P_mat(i,4)+box_length;
  R_vec((18*n_total+i),2) = R_vec(i,2);
  P_mat((19*n_total+i),2) = P_mat(i,2);
  P_mat((19*n_total+i),3) = P_mat(i,3)-box_length;
  P_mat((19*n_total+i),4) = P_mat(i,4)+box_length;
  R_vec((19*n_total+i),2) = R_vec(i,2);
  P_mat((20*n_total+i),2) = P_mat(i,2)+box_length;
  P_mat((20*n_total+i),3) = P_mat(i,3)-box_length;
  P_mat((20*n_total+i),4) = P_mat(i,4)+box_length;
  R_vec((20*n_total+i),2) = R_vec(i,2);
  P_mat((21*n_total+i),2) = P_mat(i,2)-box_length;
  P_mat((21*n_total+i),3) = P_mat(i,3);
  P_mat((21*n_total+i),4) = P_mat(i,4)+box_length;
  R_vec((21*n_total+i),2) = R_vec(i,2);
  P_mat((22*n_total+i),2:3) = P_mat(i,2:3);
  P_mat((22*n_total+i),4) = P_mat(i,4)+box_length;
  R_vec((22*n_total+i),2) = R_vec(i,2);
  P_mat((23*n_total+i),2) = P_mat(i,2)+box_length;
  P_mat((23*n_total+i),3) = P_mat(i,3);
  P_mat((23*n_total+i),4) = P_mat(i,4)+box_length;
  R_vec((23*n_total+i),2) = R_vec(i,2);
  P_mat((24*n_total+i),2) = P_mat(i,2)-box_length;
  P_mat((24*n_total+i),3:4) = P_mat(i,3:4)+box_length;
  R_vec((24*n_total+i),2) = R_vec(i,2);
  P_mat((25*n_total+i),2) = P_mat(i,2);
  P_mat((25*n_total+i),3:4) = P_mat(i,3:4)+box_length;
  R_vec((25*n_total+i),2) = R_vec(i,2);
  P_mat((26*n_total+i),2) = P_mat(i,2)+box_length;
  P_mat((26*n_total+i),3:4) = P_mat(i,3:4)+box_length;
  R_vec((26*n_total+i),2) = R_vec(i,2);

  P_mat((n_total+1):27*n_total,1) = ((n_total+1):1:27*n_total)';
  R_vec((n_total+1):27*n_total,1) = ((n_total+1):1:27*n_total)';

end
